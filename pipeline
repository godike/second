pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/godike/second.git'
            }
        }

        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
stage('SonarQube Scan') {
steps {
sh 'ls -ltr'
sh ''' mvn sonar:sonar \\
-Dsonar.host.url=http://100.26.227.191:9000 \\
-Dsonar.login=squ_19733ad4e43d54992ef61923b91447e2d17a3062'''
}
}
stage('Build Artifact') {
steps {
echo 'Build Artifact'
// Clean and package the project using Maven
sh 'mvn clean package'
}
}
stage('Build Docker Image') {
steps {
echo 'Build Docker Image'
// Build the Docker image using the Dockerfile in the project
// Tag the image with the current build number
sh 'docker build -t devopshubg333/batch13:${BUILD_NUMBER} .'
}
}
stage('Push to Docker Hub') {
steps {
script {
// Use Dockerhub credentials to access Docker Hub
withCredentials([string(credentialsId: 'dockerhub', variable: 'dockerhub')]) {
sh 'docker login -u devopshubg333 -p ${dockerhub}'
}
// Push the Docker image to Docker Hub
sh 'docker push devopshubg333/batch13:${BUILD_NUMBER}'
echo 'Pushed to Docker Hub'
}
}
}
    }
}
